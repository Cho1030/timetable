<!DOCTYPE html>
<html lang="ko">
<head>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="íƒ€ì„í…Œì´ë¸”">
<link rel="apple-touch-icon" href="icon-192.png">

<link rel="manifest" href="manifest.json">
<meta charset="UTF-8">
<title>íƒ€ì„í…Œì´ë¸”</title>

<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
/* ê¸°ì¡´ ìŠ¤íƒ€ì¼ */
body{ margin:0; padding:10px; font-family: Arial, sans-serif; background:#f9f9f9; padding-bottom: 100px; transition: background 0.3s; }
.title{ display:flex; justify-content:center; align-items:baseline; gap:10px; margin-bottom:6px; }
.title h2{ margin:0; font-size:18px; }
#nowTime{ font-size:26px; font-weight:900; color:#d32f2f; }
.controls{ text-align:center; margin-bottom:6px; }
.controls input, .controls select{ font-size:14px; padding:4px; width:70px; margin:2px; text-align:center; }
#container{ position:relative; width:260px; height:260px; margin:0 auto; }
#square{ position:absolute; top:20px; left:20px; width:220px; height:220px; border:3px solid #3f51b5; display:grid; grid-template-columns:1fr 1fr; grid-template-rows:1fr 1fr; box-sizing:border-box; }
.time{ background:#e3f2fd; border-radius:10px; padding:3px 8px; margin:2px 0; font-size:13px; white-space:nowrap; }
.top-left, .bottom-left{ display:flex; flex-direction:column; align-items:flex-start; padding-left:4px; text-align:left; }
.top-right, .bottom-right{ display:flex; flex-direction:column; align-items:flex-end; padding-right:4px; text-align:right; }
.bottom-left, .bottom-right{ justify-content: flex-end; }
.corner-btn{ position:absolute; font-size:12px; padding:4px 8px; border-radius:6px; border:2px solid #3f51b5; background:#fff; }
.btn-tl{top:0;left:0;transform:translate(-60%,-60%)}
.btn-tr{top:0;right:0;transform:translate(60%,-60%)}
.btn-bl{bottom:0;left:0;transform:translate(-60%,60%)}
.btn-br{bottom:0;right:0;transform:translate(60%,60%)}
.expired { color: #999; background: #eee; text-decoration: line-through; }
.current-nearest { background: #ffeb3b; font-weight: bold; }
.entry-highlight { background: #c8e6c9; font-weight: bold; }

/* âœ… ì¶”ê°€: ì•ŒëŒ ì œì–´ UI */
.alarm-area {
  position: fixed;
  bottom: 20px;
  left: 0;
  right: 0;
  text-align: center;
  pointer-events: none;
}
.alarm-btn {
  pointer-events: auto;
  padding: 12px 24px;
  font-size: 16px;
  font-weight: bold;
  border-radius: 50px;
  border: none;
  background: #3f51b5;
  color: white;
  box-shadow: 0 4px 15px rgba(0,0,0,0.2);
  cursor: pointer;
}
.alarm-btn.active { background: #f44336; }
</style>
</head>

<body>

<div class="title">
  <h2>ğŸ“‹ íƒ€ì„í…Œì´ë¸”</h2>
  <span id="nowTime">--:--</span>
</div>

<div class="controls">
  <input id="startTime" placeholder="0800" maxlength="4">
  <select id="startCorner">
    <option value="0">ì¢Œìƒ</option>
    <option value="1">ìš°ìƒ</option>
    <option value="2">ìš°í•˜</option>
    <option value="3">ì¢Œí•˜</option>
  </select>
</div>

<div id="container">
 <div id="square">
  <div class="top-left" id="c0"></div>
  <div class="top-right" id="c1"></div>
  <div class="bottom-left" id="c3"></div>
  <div class="bottom-right" id="c2"></div>
</div>
<button class="corner-btn btn-tl" onclick="highlightEntry(0)">ë©”ì¸</button>
<button class="corner-btn btn-tr" onclick="highlightEntry(1)">ë©”ì¸</button>
<button class="corner-btn btn-br" onclick="highlightEntry(2)">ë©”ì¸</button>
<button class="corner-btn btn-bl" onclick="highlightEntry(3)">ë©”ì¸</button>
</div>

<div class="alarm-area">
  <button id="alarmToggle" class="alarm-btn" onclick="toggleAlarm()">ğŸ”” 20ë¶„ ì•ŒëŒ ì‹œì‘</button>
</div>

<script>
/* ê¸°ì¡´ ë¡œì§ */
let activeEntries = new Set();
const order = [[0,1,2,3],[1,2,3,0],[2,3,0,1],[3,0,1,2]];
const input = document.getElementById("startTime");
const select = document.getElementById("startCorner");

function draw(){
  const v = input.value;
  if(v.length!==4) return;
  const h=parseInt(v.slice(0,2));
  const m=parseInt(v.slice(2,4));
  if(h>23||m>59) return;
  document.querySelectorAll("#square > div").forEach(d=>d.innerHTML="");
  let t=new Date();
  t.setHours(h,m,0,0);
  let end=new Date();
  end.setHours(18,0,0,0);
  let i=0;
  while(t<=end){
    const d=document.createElement("div");
    d.className="time";
    d.innerText=t.toTimeString().slice(0,5);
    d.dataset.time = t.getTime();
    document.getElementById("c"+order[select.value][i%4]).appendChild(d);
    t=new Date(t.getTime()+40*60000);
    i++;
  }
}
input.addEventListener("input",draw);
select.addEventListener("change",draw);

function updateNow(){
  const n=new Date();
  document.getElementById("nowTime").innerText=
    String(n.getHours()).padStart(2,"0")+":"+
    String(n.getMinutes()).padStart(2,"0");
  checkAlarm(n); // ì•ŒëŒ ì²´í¬
}
setInterval(updateNow,1000);
updateNow();

function updateTimeStatus(){
  const now = Date.now();
  const times = document.querySelectorAll(".time");
  let nearestPast = null;
  let nearestDiff = Infinity;
  times.forEach(el => {
    const t = parseInt(el.dataset.time);
    el.classList.remove("expired", "current-nearest");
    if(t < now){
      el.classList.add("expired");
      const diff = now - t;
      if(diff < nearestDiff){ nearestDiff = diff; nearestPast = el; }
    }
  });
  if(nearestPast){
    nearestPast.classList.remove("expired");
    nearestPast.classList.add("current-nearest");
  }
}
setInterval(updateTimeStatus, 1000);

function highlightEntry(corner){
  const protectedItem = document.querySelector(".current-nearest");
  if(activeEntries.has(corner)){
    document.querySelectorAll("#c"+corner+" .entry-highlight").forEach(e => e.classList.remove("entry-highlight"));
    activeEntries.delete(corner);
    return;
  }
  activeEntries.add(corner);
  const now = Date.now();
  const list = [...document.querySelectorAll("#c"+corner+" .time")]
    .filter(el => el !== protectedItem)
    .map(el => ({ el, diff: Math.abs(now - parseInt(el.dataset.time)) }))
    .sort((a,b)=>a.diff-b.diff).slice(0,3);
  list.forEach(o => { o.el.classList.add("entry-highlight"); });
}

/* âœ… ì•ŒëŒ ë° ìë™ ì¢…ë£Œ ë¡œì§ */
let alarmActive = false;
let lastTriggeredMinute = -1;

function toggleAlarm() {
  alarmActive = !alarmActive;
  const btn = document.getElementById("alarmToggle");
  if(alarmActive) {
    btn.innerText = "ğŸ”• ì•ŒëŒ ì¢…ë£Œí•˜ê¸°";
    btn.classList.add("active");
    // ì•„ì´í° ì§„ë™ ê¶Œí•œ í™•ì¸ìš© (ì„ íƒ)
    if(navigator.vibrate) navigator.vibrate(200);
  } else {
    btn.innerText = "ğŸ”” 20ë¶„ ì•ŒëŒ ì‹œì‘";
    btn.classList.remove("active");
  }
}

function checkAlarm(now) {
  if (!alarmActive) return;

  const h = now.getHours();
  const m = now.getMinutes();

  // 1. 18ì‹œ(ì˜¤í›„ 6ì‹œ) ìë™ ì¢…ë£Œ
  if (h >= 18) {
    alarmActive = false;
    const btn = document.getElementById("alarmToggle");
    btn.innerText = "ğŸ”” 20ë¶„ ì•ŒëŒ ì‹œì‘";
    btn.classList.remove("active");
    return;
  }

  // 2. 10ì‹œë¶€í„° 18ì‹œ ì‚¬ì´, 20ë¶„ ê°„ê²© (0, 20, 40ë¶„)
  if (h >= 10 && m % 20 === 0 && m !== lastTriggeredMinute) {
    triggerAlarm();
    lastTriggeredMinute = m;
  }
}

function triggerAlarm() {
  // ì‹œê°ì  ì•Œë¦¼ (ë°°ê²½ìƒ‰ ë³€ê²½)
  document.body.style.background = "#ffcdd2";
  setTimeout(() => { document.body.style.background = "#f9f9f9"; }, 3000);

  // ì§„ë™ ì•Œë¦¼ (ì§€ì› ê¸°ê¸°)
  if (navigator.vibrate) {
    navigator.vibrate([400, 200, 400]);
  }
}
</script>
</body>
</html>