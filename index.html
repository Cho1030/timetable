<!DOCTYPE html>
<html lang="ko">
<head>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="íƒ€ì„í…Œì´ë¸”">
<link rel="apple-touch-icon" href="icon-192.png">

<link rel="manifest" href="manifest.json">
<meta charset="UTF-8">
<title>íƒ€ì„í…Œì´ë¸”</title>

<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
/* ê¸°ì¡´ ìŠ¤íƒ€ì¼ ìœ ì§€ */
body{ margin:0; padding:10px; font-family: Arial, sans-serif; background:#f9f9f9; transition: background 0.3s; }
.title{ display:flex; justify-content:center; align-items:baseline; gap:10px; margin-bottom:6px; }
.title h2{ margin:0; font-size:18px; }
#nowTime{ font-size:26px; font-weight:900; color:#d32f2f; }
.controls{ text-align:center; margin-bottom:6px; }
.controls input, .controls select{ font-size:14px; padding:4px; width:70px; margin:2px; text-align:center; }

/* ì»¨í…Œì´ë„ˆ ë° ì‚¬ê°í˜• ì„¤ì • */
#container{ position:relative; width:260px; margin:0 auto; padding-bottom: 60px; } /* ë²„íŠ¼ ê³µê°„ í™•ë³´ */
#square{ position:relative; width:220px; height:220px; border:3px solid #3f51b5; display:grid; grid-template-columns:1fr 1fr; grid-template-rows:1fr 1fr; box-sizing:border-box; margin: 20px auto; }

.time{ background:#e3f2fd; border-radius:10px; padding:3px 8px; margin:2px 0; font-size:13px; white-space:nowrap; }
.top-left, .bottom-left{ display:flex; flex-direction:column; align-items:flex-start; padding-left:4px; text-align:left; }
.top-right, .bottom-right{ display:flex; flex-direction:column; align-items:flex-end; padding-right:4px; text-align:right; }
.bottom-left, .bottom-right{ justify-content: flex-end; }

/* ì…êµ¬ ë²„íŠ¼ */
.corner-btn{ position:absolute; font-size:12px; padding:4px 8px; border-radius:6px; border:2px solid #3f51b5; background:#fff; z-index: 10; }
.btn-tl{top: -10px; left: -10px;}
.btn-tr{top: -10px; right: -10px;}
.btn-bl{bottom: -10px; left: -10px;}
.btn-br{bottom: -10px; right: -10px;}

.expired { color: #999; background: #eee; text-decoration: line-through; }
.current-nearest { background: #ffeb3b; font-weight: bold; }
.entry-highlight { background: #c8e6c9; font-weight: bold; }

/* âœ… ì•ŒëŒ ë²„íŠ¼ ìœ„ì¹˜ ìˆ˜ì •: ì‚¬ê°í˜• ë°”ë¡œ ì•„ë˜ */
.alarm-wrapper {
  text-align: center;
  margin-top: 30px;
}
.alarm-btn {
  padding: 10px 20px;
  font-size: 15px;
  font-weight: bold;
  border-radius: 20px;
  border: 2px solid #3f51b5;
  background: #fff;
  color: #3f51b5;
  cursor: pointer;
  transition: all 0.2s;
}
.alarm-btn.active {
  background: #f44336;
  color: #fff;
  border-color: #f44336;
}
</style>
</head>

<body>

<div class="title">
  <h2>ğŸ“‹ íƒ€ì„í…Œì´ë¸”</h2>
  <span id="nowTime">--:--</span>
</div>

<div class="controls">
  <input id="startTime" placeholder="0800" maxlength="4">
  <select id="startCorner">
    <option value="0">ì¢Œìƒ</option>
    <option value="1">ìš°ìƒ</option>
    <option value="2">ìš°í•˜</option>
    <option value="3">ì¢Œí•˜</option>
  </select>
</div>

<div id="container">
  <div id="square">
    <div class="top-left" id="c0"></div>
    <div class="top-right" id="c1"></div>
    <div class="bottom-left" id="c3"></div>
    <div class="bottom-right" id="c2"></div>
    
    <button class="corner-btn btn-tl" onclick="highlightEntry(0)">ë©”ì¸</button>
    <button class="corner-btn btn-tr" onclick="highlightEntry(1)">ë©”ì¸</button>
    <button class="corner-btn btn-br" onclick="highlightEntry(2)">ë©”ì¸</button>
    <button class="corner-btn btn-bl" onclick="highlightEntry(3)">ë©”ì¸</button>
  </div>

  <div class="alarm-wrapper">
    <button id="alarmToggle" class="alarm-btn" onclick="toggleAlarm()">ğŸ”” 20ë¶„ ì•ŒëŒ ì¼œê¸°</button>
  </div>
</div>

<script>
/* ê¸°ì¡´ ë¡œì§ ë° ì•ŒëŒ ë¡œì§ ë™ì¼í•˜ê²Œ ìœ ì§€ */
let activeEntries = new Set();
const order = [[0,1,2,3],[1,2,3,0],[2,3,0,1],[3,0,1,2]];
const input = document.getElementById("startTime");
const select = document.getElementById("startCorner");

function draw(){
  const v = input.value;
  if(v.length!==4) return;
  const h=parseInt(v.slice(0,2));
  const m=parseInt(v.slice(2,4));
  if(h>23||m>59) return;
  document.querySelectorAll("#square > div").forEach(d=>d.innerHTML="");
  let t=new Date();
  t.setHours(h,m,0,0);
  let end=new Date();
  end.setHours(18,0,0,0);
  let i=0;
  while(t<=end){
    const d=document.createElement("div");
    d.className="time";
    d.innerText=t.toTimeString().slice(0,5);
    d.dataset.time = t.getTime();
    document.getElementById("c"+order[select.value][i%4]).appendChild(d);
    t=new Date(t.getTime()+40*60000);
    i++;
  }
}
input.addEventListener("input",draw);
select.addEventListener("change",draw);

function updateNow(){
  const n=new Date();
  document.getElementById("nowTime").innerText=
    String(n.getHours()).padStart(2,"0")+":"+
    String(n.getMinutes()).padStart(2,"0");
  checkAlarm(n);
}
setInterval(updateNow,1000);
updateNow();

function updateTimeStatus(){
  const now = Date.now();
  const times = document.querySelectorAll(".time");
  let nearestPast = null;
  let nearestDiff = Infinity;
  times.forEach(el => {
    const t = parseInt(el.dataset.time);
    el.classList.remove("expired", "current-nearest");
    if(t < now){
      el.classList.add("expired");
      const diff = now - t;
      if(diff < nearestDiff){ nearestDiff = diff; nearestPast = el; }
    }
  });
  if(nearestPast){
    nearestPast.classList.remove("expired");
    nearestPast.classList.add("current-nearest");
  }
}
setInterval(updateTimeStatus, 1000);

function highlightEntry(corner){
  const protectedItem = document.querySelector(".current-nearest");
  if(activeEntries.has(corner)){
    document.querySelectorAll("#c"+corner+" .entry-highlight").forEach(e => e.classList.remove("entry-highlight"));
    activeEntries.delete(corner);
    return;
  }
  activeEntries.add(corner);
  const now = Date.now();
  const list = [...document.querySelectorAll("#c"+corner+" .time")]
    .filter(el => el !== protectedItem)
    .map(el => ({ el, diff: Math.abs(now - parseInt(el.dataset.time)) }))
    .sort((a,b)=>a.diff-b.diff).slice(0,3);
  list.forEach(o => { o.el.classList.add("entry-highlight"); });
}

/* ì•ŒëŒ ë¡œì§ */
let alarmActive = false;
let lastTriggeredMinute = -1;

function toggleAlarm() {
  alarmActive = !alarmActive;
  const btn = document.getElementById("alarmToggle");
  if(alarmActive) {
    btn.innerText = "ğŸ”• ì•ŒëŒ ë„ê¸°";
    btn.classList.add("active");
  } else {
    btn.innerText = "ğŸ”” 20ë¶„ ì•ŒëŒ ì¼œê¸°";
    btn.classList.remove("active");
  }
}

function checkAlarm(now) {
  if (!alarmActive) return;
  const h = now.getHours();
  const m = now.getMinutes();

  if (h >= 18) {
    alarmActive = false;
    document.getElementById("alarmToggle").classList.remove("active");
    return;
  }

  if (h >= 10 && m % 20 === 0 && m !== lastTriggeredMinute) {
    if (navigator.vibrate) navigator.vibrate([400, 200, 400]);
    document.body.style.background = "#ffcdd2";
    setTimeout(() => { document.body.style.background = "#f9f9f9"; }, 3000);
    lastTriggeredMinute = m;
  }
}
</script>
</body>
</html>
