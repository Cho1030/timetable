<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>íƒ€ì„í…Œì´ë¸”</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
/* 1. ì›ë³¸ ë ˆì´ì•„ì›ƒ ë° ìœ„ì¹˜ê°’ (ì ˆëŒ€ ìˆ˜ì • ê¸ˆì§€) */
body{ margin:0; padding:10px; font-family: Arial, sans-serif; background:#f9f9f9; transition: background 0.3s; }
.title{ display:flex; justify-content:center; align-items:baseline; gap:10px; margin-bottom:6px; }
.title h2{ margin:0; font-size:18px; }
#nowTime{ font-size:26px; font-weight:900; color:#d32f2f; }
.controls{ text-align:center; margin-bottom:6px; }
.controls input, .controls select{ font-size:14px; padding:4px; width:70px; margin:2px; text-align:center; }

#container{ position:relative; width:260px; height:260px; margin:0 auto; }
#square{ position:absolute; top:20px; left:20px; width:220px; height:220px; border:3px solid #3f51b5; display:grid; grid-template-columns:1fr 1fr; grid-template-rows:1fr 1fr; box-sizing:border-box; }

.time{ background:#e3f2fd; border-radius:10px; padding:3px 8px; margin:2px 0; font-size:13px; white-space:nowrap; }
.top-left, .bottom-left{ display:flex; flex-direction:column; align-items:flex-start; padding-left:4px; text-align:left; }
.top-right, .bottom-right{ display:flex; flex-direction:column; align-items:flex-end; padding-right:4px; text-align:right; }
.bottom-left, .bottom-right{ justify-content: flex-end; }

.corner-btn{ position:absolute; font-size:12px; padding:4px 8px; border-radius:6px; border:2px solid #3f51b5; background:#fff; cursor: pointer; z-index: 10; }
.btn-tl{top:0;left:0;transform:translate(-60%,-60%)}
.btn-tr{top:0;right:0;transform:translate(60%,-60%)}
.btn-bl{bottom:0;left:0;transform:translate(-60%,60%)}
.btn-br{bottom:0;right:0;transform:translate(60%,60%)}

.expired { color: #999; background: #eee; text-decoration: line-through; }
.current-nearest { background: #ffeb3b; font-weight: bold; }
.entry-highlight { background: #c8e6c9; font-weight: bold; }

/* 2. âœ… ì•ŒëŒ ë²„íŠ¼ì„ 'ë ˆì´ì•„ì›ƒì— ì˜í–¥ì„ ì£¼ì§€ ì•ŠëŠ” ì ˆëŒ€ ì¢Œí‘œ'ë¡œ ì„¤ì • */
.alarm-fixed-area {
  position: absolute; /* ë‹¤ë¥¸ ìš”ì†Œì˜ ìœ„ì¹˜ë¥¼ ë°€ì–´ë‚´ì§€ ì•ŠìŒ */
  top: 280px;         /* ì‚¬ê°í˜•(260px) ì•„ë˜ì— ê³ ì • */
  left: 50%;
  transform: translateX(-50%);
  width: 260px;
  text-align: center;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 10px;
}
.alarm-btn-group { display: flex; gap: 8px; }
.alarm-btn { padding: 8px 12px; font-size: 13px; border-radius: 8px; border: 1px solid #3f51b5; background: white; cursor: pointer; white-space: nowrap; }
.alarm-btn.active { background: #3f51b5; color: white; }
#stopVibeBtn { background: #f44336; color: white; border: none; display: none; padding: 10px 20px; border-radius: 20px; font-weight: bold; }
</style>
</head>
<body>

<div class="title">
  <h2>ğŸ“‹ íƒ€ì„í…Œì´ë¸”</h2>
  <span id="nowTime">--:--</span>
</div>

<div class="controls">
  <input id="startTime" placeholder="0800" maxlength="4">
  <select id="startCorner">
    <option value="0">ì¢Œìƒ</option>
    <option value="1">ìš°ìƒ</option>
    <option value="2">ìš°í•˜</option>
    <option value="3">ì¢Œí•˜</option>
  </select>
</div>

<div id="container">
  <div id="square">
    <div class="top-left" id="c0"></div>
    <div class="top-right" id="c1"></div>
    <div class="bottom-left" id="c3"></div>
    <div class="bottom-right" id="c2"></div>
  </div>

  <button class="corner-btn btn-tl" onclick="highlightEntry(0)">ë©”ì¸</button>
  <button class="corner-btn btn-tr" onclick="highlightEntry(1)">ë©”ì¸</button>
  <button class="corner-btn btn-br" onclick="highlightEntry(2)">ë©”ì¸</button>
  <button class="corner-btn btn-bl" onclick="highlightEntry(3)">ë©”ì¸</button>

  <div class="alarm-fixed-area">
    <div class="alarm-btn-group">
      <button id="alarmOnBtn" class="alarm-btn" onclick="setAlarmState(true)">ğŸ”” ì•ŒëŒ ì¼œê¸°</button>
      <button id="alarmOffBtn" class="alarm-btn" onclick="setAlarmState(false)">ğŸ”• ì•ŒëŒ ë„ê¸°</button>
    </div>
    <button id="stopVibeBtn" onclick="stopVibration()">ğŸ›‘ ì§„ë™ ë©ˆì¶¤</button>
  </div>
</div>

<script>
/* ì›ë³¸ ë¡œì§ ìœ ì§€ */
let activeEntries = new Set();
const order = [[0,1,2,3],[1,2,3,0],[2,3,0,1],[3,0,1,2]];
const input = document.getElementById("startTime");
const select = document.getElementById("startCorner");

function draw(){
  const v = input.value;
  if(v.length!==4) return;
  const h=parseInt(v.slice(0,2));
  const m=parseInt(v.slice(2,4));
  if(h>23||m>59) return;
  document.querySelectorAll("#square > div").forEach(d=>d.innerHTML="");
  let t=new Date();
  t.setHours(h,m,0,0);
  let end=new Date();
  end.setHours(18,0,0,0);
  let i=0;
  while(t<=end){
    const d=document.createElement("div");
    d.className="time";
    d.innerText=t.toTimeString().slice(0,5);
    d.dataset.time = t.getTime();
    document.getElementById("c"+order[select.value][i%4]).appendChild(d);
    t=new Date(t.getTime()+40*60000);
    i++;
  }
}
input.addEventListener("input",draw);
select.addEventListener("change",draw);

function updateNow(){
  const n=new Date();
  document.getElementById("nowTime").innerText=
    String(n.getHours()).padStart(2,"0")+":"+
    String(n.getMinutes()).padStart(2,"0");
  checkAlarm(n);
}
setInterval(updateNow,1000);
updateNow();

function updateTimeStatus(){
  const now = Date.now();
  const times = document.querySelectorAll(".time");
  let nearestPast = null;
  let nearestDiff = Infinity;
  times.forEach(el => {
    const t = parseInt(el.dataset.time);
    el.classList.remove("expired", "current-nearest");
    if(t < now){
      el.classList.add("expired");
      const diff = now - t;
      if(diff < nearestDiff){ nearestDiff = diff; nearestPast = el; }
    }
  });
  if(nearestPast){
    nearestPast.classList.remove("expired");
    nearestPast.classList.add("current-nearest");
  }
}
setInterval(updateTimeStatus, 1000);

function highlightEntry(corner){
  const protectedItem = document.querySelector(".current-nearest");
  if(activeEntries.has(corner)){
    document.querySelectorAll("#c"+corner+" .entry-highlight").forEach(e => e.classList.remove("entry-highlight"));
    activeEntries.delete(corner);
    return;
  }
  activeEntries.add(corner);
  const now = Date.now();
  const list = [...document.querySelectorAll("#c"+corner+" .time")]
    .filter(el => el !== protectedItem)
    .map(el => ({ el, diff: Math.abs(now - parseInt(el.dataset.time)) }))
    .sort((a,b)=>a.diff-b.diff).slice(0,3);
  list.forEach(o => { o.el.classList.add("entry-highlight"); });
}

/* ì•ŒëŒ ë° ì§„ë™ ë¡œì§ */
let alarmEnabled = false;
let lastAlarmMinute = -1;

function setAlarmState(state) {
  alarmEnabled = state;
  document.getElementById("alarmOnBtn").classList.toggle("active", state);
  if(state) {
    if (navigator.vibrate) navigator.vibrate(200); 
  } else {
    stopVibration();
  }
}

function checkAlarm(now) {
  if (!alarmEnabled) return;
  const h = now.getHours();
  const m = now.getMinutes();
  if (h >= 10 && h < 18 && m !== lastAlarmMinute) {
    triggerAlarm();
    lastAlarmMinute = m;
  }
}

function triggerAlarm() {
  if (navigator.vibrate) navigator.vibrate(5000); // 5ì´ˆ ì§„ë™
  document.getElementById("stopVibeBtn").style.display = "block";
  document.body.style.background = "#ffcdd2";
  setTimeout(() => {
    if(document.body.style.background !== "rgb(249, 249, 249)") {
      document.body.style.background = "#f9f9f9";
    }
  }, 5000);
}

function stopVibration() {
  if (navigator.vibrate) navigator.vibrate(0);
  document.getElementById("stopVibeBtn").style.display = "none";
  document.body.style.background = "#f9f9f9";
}
</script>
</body>
</html>
